<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>Web Markdown Editor</title>
        <link rel="icon" type="image/x-icon" href="../../../assets/favicon.ico" />
        <!-- Font Awesome icons (free version)-->
        <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
        <!-- Google fonts-->
        <link href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css" />
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="../../../css/blog_style.css" rel="stylesheet" />
        <!-- Prism.js CSS -->
        <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/themes/prism.min.css" rel="stylesheet" />
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
        <style>
            #toolbar {
                position: fixed; 
                top: 6vh;  
                z-index: 1000;    
            }
            .masthead {
                position: relative;
                background: no-repeat center center scroll;
                -webkit-background-size: cover;
                -moz-background-size: cover;
                background-size: cover;
                height: 10px; 
                overflow: hidden; 
            }
            body {
                display: flex;
                flex-direction: column;
                height: 100vh;
            }
            #content {
                display: block;
                flex-grow: 1;
                position: relative;
            }
            #editor-panel {
                width: 50%;
                padding: 20px;
                box-sizing: border-box;
                overflow-y: auto;
                /* position: fixed; */
                position: fixed;
                top: 19vh; 
                left: 0;     
                bottom: 0;   
                height: auto; 
            }
            #preview-panel {
                width: 50%;
                padding: 20px;
                box-sizing: border-box;
                border-left: 1px solid #ddd;
                overflow-y: auto;
                /* position: absolute;  */
                position: absolute; 
                top: 0vh; 
                right: 0;     
                bottom: 0;  
                /* height: auto; */
                margin-left: 50%; 
            }
            #markdown-input {
                width: 100%;
                height: 100%;
                border: 1px solid #ccc;
                padding: 10px;
                box-sizing: border-box;
                font-family: monospace;
                font-size: 15px;
            }
            #toolbar {
                padding: 10px;
                /* border-bottom: 1px solid #ddd; */
            }
            #toolbar button {
                margin-right: 5px;
                padding: 6px 10px;
                cursor: pointer;
                font-size: 13px;
                font-weight: normal;
            }
            /* 추가적인 스타일링 */
            table {
                width: 100%;
                border-collapse: collapse;
            }
            th, td {
                border: 1px solid #ddd;
                padding: 8px;
                text-align: left;
            }
            pre {
                background-color: #f4f4f4;
                padding: 10px;
                border-radius: 5px;
                overflow-x: auto;
            }
            code {
                font-family: monospace;
            }
        </style>
        <!-- MathJax CSS -->
        <script src="../../../js/mathjax-config.js"></script>
        <script type="text/x-mathjax-config">
            MathJax.Hub.Config({            
                tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}            
            });
        </script>
        <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
        <script src="../../../js/include.js"></script>
        <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.5/marked.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/prism.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/plugins/autoloader/prism-autoloader.min.js"></script>
        <script>
            Prism.plugins.autoloader.languages_path = 'https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/components/';
        </script>
    </head>
    <body>
        <!-- Navigation-->
        <!-- Page Header-->
        <div style="margin-top: 1rem; margin-bottom: 2rem; position: inherit;">
            <div>
                <div>
                    <h2 style="margin-left: 2rem;"> Web Editor</h2>
                    <div class="post-heading">
                        <div style="text-align: center; position: fixed; right: 30vh; ">
                            <button type="button" class="btn custom-btn " onclick="setLanguage('eng')" style="font-size: 13px;">eng</button>
                            
                            <button type="button" class="btn custom-btn " onclick="setLanguage('kor')" style="font-size: 13px;">kor</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Main Content-->
        <div id="content">
            <div id="editor-panel">
                <div id="toolbar">
                    <button class="btn btn-light" style="font-size: 20px" onclick="insertHtml('<h1 id=\'h1_id\'> H1 </h1>\n')"><strong>H1</strong></button>
                    <button class="btn btn-light" style="font-size: 18px" onclick="insertHtml('<h2 id=\'h2_id\'> H2 </h2>\n')"><strong>H2</strong></button>
                    <button class="btn btn-light" style="font-size: 16px" onclick="insertHtml('<h3 id=\'h3_id\'> H3 </h3>\n')"><strong>H3</strong></button>
                    <button class="btn btn-light" onclick="insertHtml('<p class=\'lang eng\'> Eng </p>\n')">eng</button>
                    <button class="btn btn-light" onclick="insertHtml('<p class=\'lang kor\'> Kor </p>\n')">kor</button>
                    <button class="btn btn-light" onclick="insertHtml('<strong>  text </strong>')"><strong>Bold</strong></button>
                    <button class="btn btn-light" onclick="insertHtml('<em> text </em>')"><em>Ital.</em></button>
                    <button class="btn btn-light" onclick="insertHtml('<strong><em>  text </em></strong>')"><strong><em>B+I</em></strong></button>
                    <button class="btn btn-light" style="color: blue" onclick="insertHtml('<a href=\' url \'> Link Text </a>')"><i class="bi bi-link"></i> link</button>
                    <button class="btn btn-light"  onclick="insertHtml('<p>$$ Equation $$</p>\n')">$e=mc^2 $</button>
                    <button class="btn btn-light"  onclick="insertHtml('$ equation $')">$ (x,y, z) $</button>
                    <br/>
                    
                    <button class="btn btn-light" onclick="insertHtml('<ol>\n  <li> List Item </li>\n</ol>\n')"><i class="bi bi-list-ol"></i> ol </button>
                    <button class="btn btn-light" onclick="insertHtml('<ul>\n  <li> List Item </li>\n</ul>\n')"><i class="bi bi-list-ul"></i> ul</button>
                    <button class="btn btn-light" onclick="insertHtml('  <li> List Item </li>')"><i class="bi bi-list"></i> li</button>
                    <button class="btn btn-light" onclick="insertHtml('<pre><code class=\'language-xxxx\'>\n// Your code here\n</code></pre>')"><i class="bi bi-code-square"></i>-in</button>
                    <button class="btn btn-light" onclick="insertCollapsibleCodeBlock()"><i class="bi bi-code-square"></i>-block</button>
                    <button class="btn btn-light" onclick="insertHtml('<code> quate </code>')"><i class="bi bi-quote"></i></button>
                    <button class="btn btn-light" onclick="insertHtml('<figure>\n  <img src=\' assets/image_name.png \' alt=\'img alt\' width=\'100%\'>\n  <figcaption style=\'text-align: center; font-size: 15px;\'><strong>Fig .</strong> Caption</figcaption>\n</figure>')"><i class="bi bi-card-image"></i></button>
                    <button class="btn btn-light" onclick="insertHtml('<div class=\'video-container\'>\n  <video controls style=\'width: 100%\'> <!-- controls autoplay playsinline loop -->\n    <source src=\' assets/vid_name.mp4 \' type=\'video/mp4\'>\n  </video>\n</div>')"><i class="bi bi-play-btn-fill"></i></button>
                    <button class="btn btn-light" onclick="insertHtml('<hr/>\n')"> hor. line</button>
                    <button class="btn btn-light" onclick="insertHtml('<br/>\n')"> space</button>
                    <br/>

                    <!-- for saving ... -->
                    <!-- <button class="btn btn-success" onclick="saveContent()">Save</button> -->
                    <!-- <button class="btn btn-sm btn-success" onclick="loadContent()"><i class="bi bi-arrow-clockwise"></i> Load</button> -->
                    <button class="btn btn-sm btn-success" onclick="downloadContent()"><i class="bi bi-download"></i> Save</button>
                    <button class="btn btn-sm btn-success" onclick="uploadContent()"><i class="bi bi-upload"></i> Load</button>
                </div>
                <textarea id="markdown-input" class="language-markdown"></textarea>
            </div>
            <div id="preview-panel">
                <h1>Title</h1> 
            </div>
        </div>
        <script>
            const markdownInput = document.getElementById('markdown-input');
            const previewPanel = document.getElementById('preview-panel');

            previewPanel.innerHTML = marked.parse('');

            function insertHtml(htmlCode) {
                const input = markdownInput;
                const start = input.selectionStart;
                const end = input.selectionEnd;
                const text = input.value;
                const selectedText = text.substring(start, end); // chosen text

                let htmlToInsert = htmlCode; // dummy text to insert

                if (start !== end) { // if text is selected
                    // Replace the dummy text with the selected text
                    if (htmlCode.includes(' H1 ')) {
                        htmlToInsert = htmlCode.replace(' H1 ', selectedText);
                    } else if (htmlCode.includes(' H2 ')) {
                        htmlToInsert = htmlCode.replace(' H2 ', selectedText);
                    } else if (htmlCode.includes(' H3 ')) {
                        htmlToInsert = htmlCode.replace(' H3 ', selectedText);
                    } else if (htmlCode.includes(' Eng ')) {
                        htmlToInsert = htmlCode.replace(' Eng ', selectedText);
                    } else if (htmlCode.includes(' Kor ')) {
                        htmlToInsert = htmlCode.replace(' Kor ', selectedText);
                    } else if (htmlCode.includes(' url ')) { // Link button
                        htmlToInsert = htmlCode.replace(' url ', selectedText);
                    } else if (htmlCode.includes('  text ')) { // B, I, BI buttons (note double space before 'text')
                        htmlToInsert = htmlCode.replace('  text ', selectedText); // For B, I, BI buttons
                    } else if (htmlCode.includes('$$ Equation $$')) { // Math_B button
                        htmlToInsert = htmlCode.replace(' Equation ', selectedText);
                    } else if (htmlCode.includes('$ equation $')) { // Math_I button
                        htmlToInsert = htmlCode.replace(' equation ', selectedText);
                    } else if (htmlCode.includes(' List Item ')) { // OL, UL, Li buttons
                        htmlToInsert = htmlCode.replace(' List Item ', selectedText);
                    } else if (htmlCode.includes('// Your code here')) { // Code button
                        htmlToInsert = htmlCode.replace('// Your code here', selectedText);
                    } else if (htmlCode.includes(' quate ')) { // Quate button
                        htmlToInsert = htmlCode.replace(' quate ', selectedText);
                    } else if (htmlCode.includes(' assets/image_name.png ')) { // Img button
                        htmlToInsert = htmlCode.replace(' assets/image_name.png ', selectedText);
                    } else if (htmlCode.includes(' assets/vid_name.mp4 ')) { // Vid button
                        htmlToInsert = htmlCode.replace(' assets/vid_name.mp4 ', selectedText);
                    }
                    // Hor. Line and Space buttons do not have text to replace, so no condition needed for them.
                }

                const before = text.substring(0, start);
                const after = text.substring(end);

                input.value = before + htmlToInsert + after;
                input.selectionStart = start + htmlToInsert.length; // adjust cursor position
                input.selectionEnd = start + htmlToInsert.length;
                input.focus();
                // preview update
                previewPanel.innerHTML = marked.parse(input.value);
                // MathJax
                if (window.MathJax) {
                    MathJax.Hub.Queue(["Typeset", MathJax.Hub, previewPanel]);
                }
                Prism.highlightElement(markdownInput);
                Prism.highlightAll();
            }

            markdownInput.addEventListener('input', update);
            function update(){
                const input = markdownInput;
                previewPanel.innerHTML = marked.parse(markdownInput.value);
                if (window.MathJax) {
                    MathJax.Hub.Queue(["Typeset", MathJax.Hub, previewPanel]);
                }
                Prism.highlightElement(markdownInput);
                Prism.highlightAll();
            }

            function insertCollapsibleCodeBlock() {
                const codeBlock = `
<div class="accordion accordion-flush" id="accordionFlushExample">
  <div class="accordion-item">
    <h2 class="accordion-header">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseOne" aria-expanded="false" aria-controls="flush-collapseOne">
        <strong><em>Show Code!</em></strong>
      </button>
    </h2>
    <div id="flush-collapseOne" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
      <div class="accordion-body">
        <pre><code class="language-javascript">
// Your code here
        </code></pre>
      </div>
    </div>
  </div>
</div>
`;
                insertHtml(codeBlock);
            }

            function setLanguage(lang) {
                const langElements = document.querySelectorAll('.lang');
                langElements.forEach(element => {
                    if (element.classList.contains(lang)) {
                        element.style.display = '';
                    } else {
                        element.style.display = 'none';
                    }
                });
            }
            // Local Storage auto save
            const AUTO_SAVE_INTERVAL = 5000; // 5 seconds

            function saveContentToLocalStorage() {
                const content = markdownInput.value;
                localStorage.setItem(STORAGE_KEY, content);
                console.log('Content auto-saved to Local Storage.'); 
            }

            setInterval(saveContentToLocalStorage, AUTO_SAVE_INTERVAL);

            window.addEventListener('load', () => {
                const savedContent = localStorage.getItem(STORAGE_KEY);
                if (savedContent) {
                    markdownInput.value = savedContent;
                    update(); // 
                    console.log('Content loaded from Local Storage on page load.'); // 
                }
            });
        </script>
        <script>
            const STORAGE_KEY = 'markdown-editor-content'; // Local Storage 
            // save (Local Storage)
            function saveContent() {
                const content = markdownInput.value;
                localStorage.setItem(STORAGE_KEY, content);
                alert('Content saved to Local Storage!'); // 
            }

            // load (Local Storage)
            function loadContent() {
                const savedContent = localStorage.getItem(STORAGE_KEY);
                if (savedContent) {
                    markdownInput.value = savedContent;
                    update(); // preview update
                    alert('Content loaded from Local Storage!'); // 
                } else {
                    alert('No content saved in Local Storage.'); // 
                }
            }

            function downloadContent() {
                const content = markdownInput.value;
                let filename = prompt("Enter filename for download:", "markdown-editor-content"); // 
                if (!filename) { // 
                    return; // 
                }
                // (.md)
                if (!filename.toLowerCase().endsWith(".md")) {
                    filename += ".md"; // 
                }

                const blob = new Blob([content], { type: 'text/markdown' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename; // 
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }

            function uploadContent() {
                const fileInput = document.createElement('input');
                fileInput.type = 'file';
                fileInput.accept = '.md, .markdown, .txt'; 
                fileInput.onchange = (event) => {
                    const file = event.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            markdownInput.value = e.target.result;
                            update(); // 
                            alert('Content loaded from file!'); // 
                        };
                        reader.onerror = (e) => {
                            alert('Error reading file.'); // 
                        };
                        reader.readAsText(file);
                    }
                };
                fileInput.click(); // 
            }
        </script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    </body>
</html>